{% extends 'base.html' %}
{% block content %}
<h2>Záznamy</h2>

{% if admin_view %}
  <form method="get" action="{{ url_for('admin_entries') }}">
    <label>Filtruj podľa používateľa:
      <select name="user_id">
        <option value="">(všetci)</option>
        {% for u in users %}
          <option value="{{ u.id }}" {% if request.args.get('user_id', type=int)==u.id %}selected{% endif %}>{{ u.name }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Filtrovať</button>
  </form>
{% endif %}

<table>
<thead>
  <tr>
    <th>Užívateľ</th><th>Dátum</th><th>Množstvo</th><th>Projekt</th><th>Poznámka</th>
    {% if session.get('user') and session.get('user').get('role') == 'admin' %}
      <th>Akcie</th>
    {% endif %}
  </tr>
</thead>
<tbody>
{% for e in entries %}
  <tr>
    <td>{{ e.user.name }}</td>
    <td>{{ e.date }}</td>
    <td>{{ e.amount }}</td>
    <td>{{ e.project.name if e.project else '' }}</td>
    <td>{{ e.note }}</td>
    {% if session.get('user') and session.get('user').get('role') == 'admin' %}
    <td>
      <form method="post" action="{{ url_for('delete_entry', entry_id=e.id) }}" onsubmit="return confirm('Zmazať záznam?');">
        <button type="submit">Vymazať</button>
      </form>
    </td>
    {% endif %}
  </tr>
{% endfor %}
</tbody>
</table>
{% endblock %}
