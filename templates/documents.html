{% extends "base.html" %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold mb-0">Dokumenty</h3>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
      <i class="fa fa-arrow-left me-1"></i> Späť na dashboard
    </a>
  </div>

  <!-- Upload sekcia -->
  <div class="card p-4 mb-4 shadow-sm" style="max-width: 600px;">
    <h5 class="mb-3">Nahrať nový dokument</h5>
    <form method="POST" enctype="multipart/form-data">
      <div class="mb-3">
        <input type="file" name="file" class="form-control" required>
      </div>
      <button type="submit" class="btn btn-primary">
        <i class="fa fa-upload me-2"></i> Nahrať dokument
      </button>
    </form>
  </div>

  <!-- Zoznam dokumentov -->
  <div class="card p-4 shadow-sm">
    <h5 class="mb-3">
      {% if selected_user_name %}
        Dokumenty používateľa: <span class="text-primary">{{ selected_user_name }}</span>
      {% elif user.is_admin %}
        Všetky dokumenty
      {% else %}
        Moje dokumenty
      {% endif %}
    </h5>

    {% if documents %}
      <div class="table-responsive">
        <table class="table align-middle">
          <thead class="table-light">
            <tr>
              <th>Názov súboru</th>
              {% if user.is_admin %}
                <th>Používateľ</th>
              {% endif %}
              <th>Stiahnuť</th>
              {% if user.is_admin %}
                <th>Akcie</th>
              {% endif %}
            </tr>
          </thead>
          <tbody>
            {% for doc in documents %}
            <tr>
              <td><i class="fa fa-file-alt text-primary me-2"></i>{{ doc.filename }}</td>

              {% if user.is_admin %}
                <td>{{ doc.user_name or 'Neznámy používateľ' }}</td>
              {% endif %}

              <td>
                <a href="{{ url_for('uploaded_file', filename=doc.filename) }}" 
                   class="btn btn-outline-success btn-sm">
                   <i class="fa fa-download me-1"></i> Stiahnuť
                </a>
              </td>

              {% if user.is_admin %}
              <td>
                <form method="POST" 
                      action="{{ url_for('delete_document', document_id=doc.id, user_id=selected_user_id) }}"
                      onsubmit="return confirm('Naozaj chceš odstrániť dokument {{ doc.filename }}?');"
                      style="display:inline;">
                  <button class="btn btn-outline-danger btn-sm">
                    <i class="fa fa-trash"></i> Vymazať
                  </button>
                </form>
              </td>
              {% endif %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <p class="text-muted">Zatiaľ nemáte žiadne nahrané dokumenty.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
