{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3 class="fw-bold mb-0">Týždenný prehľad</h3>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addRecordModal">
      <i class="fa fa-plus me-2"></i> Pridať záznam
    </button>
  </div>

  <!-- 🔹 FILTER FORM -->
  <form method="get" class="row g-3 align-items-end mb-4">
    {% if user.is_admin %}
    <div class="col-md-4">
      <label class="form-label">Používateľ</label>
      <select name="user_id" class="form-select">
        <option value="">Všetci</option>
        {% for u in users %}
        <option value="{{ u.id }}" {% if selected_user == u.id %}selected{% endif %}>{{ u.name }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}
    <div class="col-md-4">
      <label class="form-label">Projekt</label>
      <select name="project_id" class="form-select">
        <option value="">Všetky projekty</option>
        {% for p in projects %}
        <option value="{{ p.id }}" {% if selected_project == p.id %}selected{% endif %}>{{ p.name }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <button type="submit" class="btn btn-outline-success px-4">
        <i class="fa fa-filter me-2"></i> Filtrovať
      </button>
    </div>
  </form>

  <div class="row g-4">
    <!-- Výkon podľa dní -->
    <div class="col-lg-8">
      <div class="card p-4 shadow-sm">
        <h5 class="fw-semibold mb-3">Hodiny zo záznamov</h5>
        <canvas id="hoursChart"
          data-labels='{{ chart_labels|tojson }}'
          data-values='{{ chart_values|tojson }}'></canvas>
      </div>
    </div>

    <!-- Výkon podľa projektu -->
    <div class="col-lg-4">
      <div class="card p-4 shadow-sm">
        <h5 class="fw-semibold mb-3">Výkon podľa projektu</h5>
        <canvas id="projectChart"
          data-labels='{{ project_labels|tojson }}'
          data-values='{{ project_values|tojson }}'></canvas>
      </div>
    </div>
  </div>

  <!-- Súhrny -->
  <div class="row mt-4 g-4">
    <div class="col-md-3">
      <div class="card stat-card">
        <h6 class="text-muted">Celkový výkon</h6>
        <h3>{{ "%.1f"|format(total) }}</h3>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card stat-card">
        <h6 class="text-muted">Počet projektov</h6>
        <h3>{{ project_count }}</h3>
      </div>
    </div>
  </div>
</div>

<!-- Modal na pridanie záznamu (zostáva rovnaký) -->
{% include 'partials/add_record_modal.html' %}
{% endblock %}
